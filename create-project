PROJECT=tappil
PROJECT_DIR=tappil
cd /home/apps;
mkdir -p $PROJECT_DIR;
cd -p $PROJECT;
git init --bare repo.git;
mkdir app;
echo "#!/bin/bash
HOOK_PATH="$( cd "$(dirname "$0")" ; pwd -P )"
REPO_ROOT=
APP_ROOT=
git --work-tree=$APP_ROOT --git-dir=$REPO_ROOT checkout -f master;
commit=`git rev-parse --short HEAD`;

cd $APP_ROOT;
docker-compose -f dev.yml stop;
echo "VERSION = '$commit'" > project/version.py;
docker-compose -f dev.yml build;
docker-compose -f dev.yml run --rm web ./manage.py collectstatic --noinput;
docker-compose -f dev.yml run --rm web ./manage.py migrate --noinput;
docker-compose -f dev.yml up -d;" > repo.git/hooks/post-receive;
chmod +x repo.git/hooks/post-receive;


